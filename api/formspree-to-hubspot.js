export default async function handler(req,res){if(req.method!=='POST')return res.status(405).json({error:'Method not allowed'});const t=process.env.HUBSPOT_PRIVATE_APP_TOKEN;if(!t)return res.status(500).json({error:'Missing HUBSPOT_PRIVATE_APP_TOKEN'});try{const p=typeof req.body==='string'?JSON.parse(req.body):req.body;const n=p.name||'';const e=p.email||'';const ph=p.phone||'';const r=await fetch('https://api.hubapi.com/crm/v3/objects/contacts',{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${t}`},body:JSON.stringify({properties:{email:e,firstname:n.split(' ')[0]||'',lastname:n.split(' ').slice(1).join(' ')||'Fluryy',phone:ph}})});const cj=await r.json();if(!r.ok)return res.status(502).json({error:'HubSpot contact create failed',detail:cj});res.status(200).json({ok:true});}catch(err){res.status(500).json({error:'Server error',detail:err?.message});}}